---
title: "Analyse choix de variables"
author: "Abel AUSSANT"
date: "04/05/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE)

pacman::p_load(tidyverse, questionr, gtsummary, gt, survey, here)



source(here("02_import", "import_bases.R"))

source(here("03_scripts", "tests_association.R"))

# il manque 4 pondÃ©ration...
PC18_s <- PC18

#pour que la pop total soit Ã©gale au nombre de ligne dans la base (on divise la pondÃ©ration par la somme de toutes les pondÃ©ration divisÃ© par le nombre d'individus)
PC18_s$POND <- PC18_s$POND/5629.778

print(sum(PC18_s$POND))

PC18_s <- survey::svydesign(id = ~IDENT18, data = PC18_s, weights = PC18_s$POND)

PC18_s <- subset(PC18_s, music_12m != "Jamais")

theme_gtsummary_language("fr", decimal.mark = ",", big.mark = " ")
```

## VITENCOUPLE = le fait de vivre en couple 

```{r VITENCOUPLE}



tab1 <- PC18_s %>%
  tbl_svysummary(
    include = c("stream_spe", "VITENCOUPLE_r"), #L'ensemble des variables que l'on veut dans le tableau
    label = list(stream_spe ~ "Ecoute de la musique sur une plate forme de streaming spÃ©cialisÃ©e"),
    by = VITENCOUPLE_r, #La variale avec laquelle on croise les donnÃ©es qui ira en colonne
    missing = "ifany",
    statistic = list(all_categorical() ~ "{p} % N = {n_unweighted}"),
    digits = list(all_categorical() ~ c(1,0))
  ) %>%
  add_overall() %>%
  add_p(test = everything() ~ "svy.chisq.test") %>%
  modify_footnote(update = everything() ~ NA) %>%
  as_gt()

tab1_t <- tab1 %>%
  tab_source_note(source_note = html("Source : 
                                     <br> Champ : 
                                     <br>Lecture : ")) %>%
  tab_header(title = "Ecoute de musique sur au moins une plateforme de streaming par vit en couple") %>%
  opt_table_font(font = "Times New Roman") %>%
  tab_options(table_body.hlines.color = "black", source_notes.border.bottom.color = "black", table_body.border.bottom.color = "black",
              table_body.border.top.color = "black", row_group.border.top.color = "black", row_group.border.bottom.color = "black",
              heading.border.bottom.color = "black", column_labels.border.top.color = "black",  table.border.top.color = "black",
              table.border.bottom.color = "black", column_labels.border.bottom.color = "black")

tab1_t

tab1 <- PC18_s %>%
  tbl_svysummary(
    include = c("nbr_genre_music", "VITENCOUPLE_r"), #L'ensemble des variables que l'on veut dans le tableau
    label = list(nbr_genre_music ~ "Nombre de styles musicaux Ã©coutÃ©s"),
    by = VITENCOUPLE_r, #La variale avec laquelle on croise les donnÃ©es qui ira en colonne
    missing = "ifany",
    statistic = list(all_continuous() ~ "{mean} ({sd})"),
    digits = list(all_categorical() ~ c(1,0))
  ) %>%
  add_overall() %>%
  add_p(test = everything() ~ "svy.chisq.test") %>%
  modify_footnote(update = everything() ~ NA) %>%
  as_gt()

tab1_t <- tab1 %>%
  tab_source_note(source_note = html("Source : 
                                     <br> Champ : 
                                     <br>Lecture : ")) %>%
  tab_header(title = "Nombre de styles Ã©coutÃ©s par vit en couple") %>%
  opt_table_font(font = "Times New Roman") %>%
  tab_options(table_body.hlines.color = "black", source_notes.border.bottom.color = "black", table_body.border.bottom.color = "black",
              table_body.border.top.color = "black", row_group.border.top.color = "black", row_group.border.bottom.color = "black",
              heading.border.bottom.color = "black", column_labels.border.top.color = "black",  table.border.top.color = "black",
              table.border.bottom.color = "black", column_labels.border.bottom.color = "black")

tab1_t


d_tmp <- subset(d, !is.na(d$VITENCOUPLE_r) & !is.na(d$E83))

force_lien_d_cohen(d, "nbr_genre_music", "VITENCOUPLE_r")
Vcramer_stream <- cramer.v(table(d$E83, d$VITENCOUPLE_r))


```

V de cramer entre stream et VITENCOUPLE_r = `r Vcramer_stream`

Association faible avec le nombre de styles Ã©coutÃ©s. A rejeter.


## Sorties en groupe

```{r Sorties_amis}



tab1 <- PC18_s %>%
  tbl_svysummary(
    include = c("stream_spe", "sorties_ami"), #L'ensemble des variables que l'on veut dans le tableau
    label = list(stream_spe ~ "Ecoute de la musique sur une plate forme de streaming spÃ©cialisÃ©e"),
    by = sorties_ami, #La variale avec laquelle on croise les donnÃ©es qui ira en colonne
    missing = "ifany",
    statistic = list(all_categorical() ~ "{p} % N = {n_unweighted}"),
    digits = list(all_categorical() ~ c(1,0))
  ) %>%
  add_overall() %>%
  add_p(test = everything() ~ "svy.chisq.test") %>%
  modify_footnote(update = everything() ~ NA) %>%
  as_gt()

tab1_t <- tab1 %>%
  tab_source_note(source_note = html("Source : 
                                     <br> Champ : 
                                     <br>Lecture : ")) %>%
  tab_header(title = "Ecoute de musique sur au moins une plateforme de streaming par sorties entre amis ou en famille") %>%
  opt_table_font(font = "Times New Roman") %>%
  tab_options(table_body.hlines.color = "black", source_notes.border.bottom.color = "black", table_body.border.bottom.color = "black",
              table_body.border.top.color = "black", row_group.border.top.color = "black", row_group.border.bottom.color = "black",
              heading.border.bottom.color = "black", column_labels.border.top.color = "black",  table.border.top.color = "black",
              table.border.bottom.color = "black", column_labels.border.bottom.color = "black")

tab1_t

tab1 <- PC18_s %>%
  tbl_svysummary(
    include = c("nbr_genre_music", "sorties_ami"), #L'ensemble des variables que l'on veut dans le tableau
    label = list(nbr_genre_music ~ "Nombre de styles musicaux Ã©coutÃ©s"),
    by = sorties_ami, #La variale avec laquelle on croise les donnÃ©es qui ira en colonne
    missing = "ifany",
    statistic = list(all_continuous() ~ "{mean} ({sd})"),
    digits = list(all_categorical() ~ c(1,0))
  ) %>%
  add_overall() %>%
  add_p(test = everything() ~ "svy.chisq.test") %>%
  modify_footnote(update = everything() ~ NA) %>%
  as_gt()

tab1_t <- tab1 %>%
  tab_source_note(source_note = html("Source : 
                                     <br> Champ : 
                                     <br>Lecture : ")) %>%
  tab_header(title = "Nombre de styles Ã©coutÃ©s par sorties entre amis ou en famille") %>%
  opt_table_font(font = "Times New Roman") %>%
  tab_options(table_body.hlines.color = "black", source_notes.border.bottom.color = "black", table_body.border.bottom.color = "black",
              table_body.border.top.color = "black", row_group.border.top.color = "black", row_group.border.bottom.color = "black",
              heading.border.bottom.color = "black", column_labels.border.top.color = "black",  table.border.top.color = "black",
              table.border.bottom.color = "black", column_labels.border.bottom.color = "black")

tab1_t

d_tmp <- subset(d, !is.na(d$sorties_ami) & !is.na(d$E83))

force_lien_d_cohen(d, "nbr_genre_music", "sorties_ami")
Vcramer_stream <- cramer.v(table(d$E83, d$sorties_ami))

```


V de cramer entre stream et Sorties_amis = `r Vcramer_stream`

Associations avec les deux variables, Ã  considÃ©rer.


```{r freq_info}



tab1 <- PC18_s %>%
  tbl_svysummary(
    include = c("stream_spe", "freq_info"), #L'ensemble des variables que l'on veut dans le tableau
    label = list(stream_spe ~ "Ecoute de la musique sur une plate forme de streaming spÃ©cialisÃ©e"),
    by = freq_info, #La variale avec laquelle on croise les donnÃ©es qui ira en colonne
    missing = "ifany",
    statistic = list(all_categorical() ~ "{p} % N = {n_unweighted}"),
    digits = list(all_categorical() ~ c(1,0))
  ) %>%
  add_overall() %>%
  add_p(test = everything() ~ "svy.chisq.test") %>%
  modify_footnote(update = everything() ~ NA) %>%
  as_gt()

tab1_t <- tab1 %>%
  tab_source_note(source_note = html("Source : 
                                     <br> Champ : 
                                     <br>Lecture : ")) %>%
  tab_header(title = "Ecoute de musique sur au moins une plateforme de streaming par frÃ©quence de suivi actualitÃ©") %>%
  opt_table_font(font = "Times New Roman") %>%
  tab_options(table_body.hlines.color = "black", source_notes.border.bottom.color = "black", table_body.border.bottom.color = "black",
              table_body.border.top.color = "black", row_group.border.top.color = "black", row_group.border.bottom.color = "black",
              heading.border.bottom.color = "black", column_labels.border.top.color = "black",  table.border.top.color = "black",
              table.border.bottom.color = "black", column_labels.border.bottom.color = "black")

tab1_t

tab1 <- PC18_s %>%
  tbl_svysummary(
    include = c("nbr_genre_music", "freq_info"), #L'ensemble des variables que l'on veut dans le tableau
    label = list(nbr_genre_music ~ "Nombre de styles musicaux Ã©coutÃ©s"),
    by = freq_info, #La variale avec laquelle on croise les donnÃ©es qui ira en colonne
    missing = "ifany",
    statistic = list(all_continuous() ~ "{mean} ({sd})"),
    digits = list(all_categorical() ~ c(1,0))
  ) %>%
  add_overall() %>%
  add_p(test = everything() ~ "svy.chisq.test") %>%
  modify_footnote(update = everything() ~ NA) %>%
  as_gt()

tab1_t <- tab1 %>%
  tab_source_note(source_note = html("Source : 
                                     <br> Champ : 
                                     <br>Lecture : ")) %>%
  tab_header(title = "Nombre de styles Ã©coutÃ©s par frÃ©quence de suivi actualitÃ©") %>%
  opt_table_font(font = "Times New Roman") %>%
  tab_options(table_body.hlines.color = "black", source_notes.border.bottom.color = "black", table_body.border.bottom.color = "black",
              table_body.border.top.color = "black", row_group.border.top.color = "black", row_group.border.bottom.color = "black",
              heading.border.bottom.color = "black", column_labels.border.top.color = "black",  table.border.top.color = "black",
              table.border.bottom.color = "black", column_labels.border.bottom.color = "black")

tab1_t

d_tmp <- subset(d, !is.na(d$freq_info) & !is.na(d$E83))

force_lien_d_cohen(d, "nbr_genre_music", "freq_info")
Vcramer_stream <- cramer.v(table(d$E83, d$freq_info))

```


V de cramer entre stream et freq_info = `r Vcramer_stream`

Association trÃ¨s faible, peu pertinant.


```{r comp_var_lecture}





d_tmp <- subset(d, !is.na(d$freq_lecture) & !is.na(d$E83) & !is.na(d$autojuge_lecture))



force_lien_d_cohen(d, "nbr_genre_music", "autojuge_lecture")
Vcramer_stream_auto <- cramer.v(table(d$E83, d$autojuge_lecture))

force_lien_d_cohen(d, "nbr_genre_music", "freq_lecture")
Vcramer_stream_freq <- cramer.v(table(d$E83, d$freq_lecture))

```

V de cramer entre stream et autojuge_lecture = `r Vcramer_stream_auto`

V de cramer entre stream et freq_lecture = `r Vcramer_stream_freq`

La frÃ©quence de lecture semble lÃ©gÃ©rement mieux. Pas flagrant cela dit. 

```{r logement}



tab1 <- PC18_s %>%
  tbl_svysummary(
    include = c("stream_spe", "logement"), #L'ensemble des variables que l'on veut dans le tableau
    label = list(stream_spe ~ "Ecoute de la musique sur une plate forme de streaming spÃ©cialisÃ©e"),
    by = logement, #La variale avec laquelle on croise les donnÃ©es qui ira en colonne
    missing = "ifany",
    statistic = list(all_categorical() ~ "{p} % N = {n_unweighted}"),
    digits = list(all_categorical() ~ c(1,0))
  ) %>%
  add_overall() %>%
  add_p(test = everything() ~ "svy.chisq.test") %>%
  modify_footnote(update = everything() ~ NA) %>%
  as_gt()

tab1_t <- tab1 %>%
  tab_source_note(source_note = html("Source : 
                                     <br> Champ : 
                                     <br>Lecture : ")) %>%
  tab_header(title = "Ecoute de musique sur au moins une plateforme de streaming par statut logement") %>%
  opt_table_font(font = "Times New Roman") %>%
  tab_options(table_body.hlines.color = "black", source_notes.border.bottom.color = "black", table_body.border.bottom.color = "black",
              table_body.border.top.color = "black", row_group.border.top.color = "black", row_group.border.bottom.color = "black",
              heading.border.bottom.color = "black", column_labels.border.top.color = "black",  table.border.top.color = "black",
              table.border.bottom.color = "black", column_labels.border.bottom.color = "black")

tab1_t

tab1 <- PC18_s %>%
  tbl_svysummary(
    include = c("nbr_genre_music", "logement"), #L'ensemble des variables que l'on veut dans le tableau
    label = list(nbr_genre_music ~ "Nombre de styles musicaux Ã©coutÃ©s"),
    by = logement, #La variale avec laquelle on croise les donnÃ©es qui ira en colonne
    missing = "ifany",
    statistic = list(all_continuous() ~ "{mean} ({sd})"),
    digits = list(all_categorical() ~ c(1,0))
  ) %>%
  add_overall() %>%
  add_p(test = everything() ~ "svy.chisq.test") %>%
  modify_footnote(update = everything() ~ NA) %>%
  as_gt()

tab1_t <- tab1 %>%
  tab_source_note(source_note = html("Source : 
                                     <br> Champ : 
                                     <br>Lecture : ")) %>%
  tab_header(title = "Nombre de styles Ã©coutÃ©s par statut logement") %>%
  opt_table_font(font = "Times New Roman") %>%
  tab_options(table_body.hlines.color = "black", source_notes.border.bottom.color = "black", table_body.border.bottom.color = "black",
              table_body.border.top.color = "black", row_group.border.top.color = "black", row_group.border.bottom.color = "black",
              heading.border.bottom.color = "black", column_labels.border.top.color = "black",  table.border.top.color = "black",
              table.border.bottom.color = "black", column_labels.border.bottom.color = "black")

tab1_t

d_tmp <- subset(d, !is.na(d$logement) & !is.na(d$E83))

force_lien_d_cohen(d, "nbr_genre_music", "logement")
Vcramer_stream <- cramer.v(table(d$E83, d$logement))

```


V de cramer entre stream et logement = `r Vcramer_stream`

Association faible ou juste liÃ© Ã  l'age (diffÃ©rence propriÃ©taire sans crÃ©dit/avec crÃ©dit), peu pertinant.