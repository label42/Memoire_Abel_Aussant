---
title: "estimation_resultats_finaux"
author: "Abel AUSSANT"
date: '2022-06-16'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE)

library(tidyverse)
library(here)
library(lmtest)
library(sandwich)
library(gt)
library(gtsummary)
library(boot)
library(gurobi)

source(here("02_import", "import_bases.R"))

source(here("03_scripts", "matching_final.R"))

covar_formula <- "SEXE_r + AGE + CRITREVENU_r + PCS_MENAGE + h_travail_semaine + DIPLOME_r + 
    naiss_parents + DIPLOME_pere + CS_pere + DIPLOME_mere + 
    sorties_ami + VITENCOUPLE_r + logement +  
    freq_jv + freq_tv + equip_tv + clip_tv + equip_film + film_stream_VOD + 
    film_stream_autre + film_DVD + film_num + nbr_genre_film + 
    freq_serie + equip_serie + serie_stream_VOD + serie_stream_autre + 
    nbr_genre_serie + info_internet + freq_lecture + equip_lecture + 
    nbr_genre_film_cine + musee_art_12m + galerie_12m + acces_internet + 
    freq_internet + reseaux_sociaux + culture_en_ligne + musique_enfance + 
    cinema_enfance + nbr_genre_parent_ecoute + nbr_genre_ecoute_enfance + 
    audivisuel_nonFR + autre_langue"

theme_gtsummary_language("fr", decimal.mark = ",", big.mark = " ")

PC18_to_m_survey <- survey::svydesign(id = ~IDENT18, data = PC18_to_m, weights = PC18_to_m$POND)

PC18_m_survey <- survey::svydesign(id = ~IDENT18, data = PC18_m, weights = PC18_m$POND_m)

PC18_m_1to1_survey <- survey::svydesign(id = ~IDENT18, data = PC18_m_1to1, weights = PC18_m_1to1$POND_m)

```

# Diversité des goûts et dégoûts

## Moyennes

```{r}
mean_genre_unm <- PC18_to_m_survey %>%
  tbl_svysummary(
    include = c("stream_spe", "nbr_genre_music", "nbr_genre_aime", "nbr_genre_deteste", "nbr_artiste_ecoute"), #L'ensemble des variables que l'on veut dans le tableau
    label = list(nbr_genre_music ~ "Styles musicaux écoutés",
                 nbr_genre_aime ~ "Styles particulièrement aimés",
                 nbr_genre_deteste ~ "Styles detestés",
                 nbr_artiste_ecoute ~ "Artistes écoutés"),
    by = stream_spe, #La variale avec laquelle on croise les données qui ira en colonne
    missing = "ifany",
    statistic = list(all_continuous() ~ "{mean} ({sd})"),
    digits = list(all_continuous() ~ c(1,1))
  ) %>%
  add_p(test = everything() ~ "svy.t.test") %>%
  modify_header(label = "**Nombre de :**",
    update = list(stat_1 ~ html("**Non streameur**<br> N = {n_unweighted}"),
                              stat_2 ~ html("**Streameur**<br> N = {n_unweighted}"))) %>%
  modify_footnote(update = everything() ~ NA) %>%
  modify_footnote(update = list(p.value ~ "Calculé à partir d'un test de Student.",
                                all_stat_cols() ~ "Effectifs non pondérés."))


mean_genre_m <- PC18_m_survey %>%
  tbl_svysummary(
    include = c("stream_spe", "nbr_genre_music", "nbr_genre_aime", "nbr_genre_deteste", "nbr_artiste_ecoute"), #L'ensemble des variables que l'on veut dans le tableau
    label = list(nbr_genre_music ~ "Styles musicaux écoutés",
                 nbr_genre_aime ~ "Styles particulièrement aimés",
                 nbr_genre_deteste ~ "Styles detestés",
                 nbr_artiste_ecoute ~ "Artistes écoutés"),
    by = stream_spe, #La variale avec laquelle on croise les données qui ira en colonne
    missing = "ifany",
    statistic = list(all_continuous() ~ "{mean} ({sd})"),
    digits = list(all_continuous() ~ c(1,1))
  ) %>%
  add_p(test = everything() ~ "svy.t.test") %>%
  modify_header(label = "**Nombre de :**",
    update = list(stat_1 ~ html("**Non streameur**<br> N = {n_unweighted}"),
                              stat_2 ~ html("**Streameur**<br> N = {n_unweighted}"))) %>%
  modify_footnote(update = everything() ~ NA) %>%
  modify_footnote(update = list(p.value ~ "Calculé à partir d'un test de Student.",
                                all_stat_cols() ~ "Effectifs non pondérés."))

t_comp_m <- tbl_merge(
    tbls = list(mean_genre_unm, mean_genre_m),
    tab_spanner = c("**Echantillon non matché**", "**Echantillon matché**")
  ) %>% as_gt() %>%
  tab_footnote(
    footnote = "Moyenne et écart type pondérés.",
    locations = cells_body(columns = stat_1_1,
                           rows = 1)
  ) %>%
  tab_source_note(source_note = html("<p align=\"justify\" style=\"
    margin: 0;\"><u>Source</u> : Enquête Pratique culturelles des français 2018.
                                     <br><u>Champ</u> : Résidant en France agés de 15 ans et plus, déclarant écouter de la musique.
                                     <br><u>Lecture</u> : Dans l'échantillon non matché, c'est-à-dire dans la population générale minorée des individus n'écoutant pas de musique, on observe que les non-utilisateurs de plateformes de streaming spécialisées écoutent en moyenne 3,8 (écart-type 2,2) genres musicaux différents. Ceux qui pratiquent l'écoute en streaming déclarent eux écouter 5 styles musicaux différents en moyenne (écart-type 2,5).
                                     <br> Dans la population matchée en revanche, on observe des écarts beaucoup plus faibles. Ainsi, quand on raisonne toutes choses égales par ailleurs, les non-streameurs écoutent 4,8 styles musicaux différents en moyenne (écart-type 2,5), alors que les streameurs en écoutent 5 (écart-type 2,5).</p>")) %>%
  opt_table_font(font = "Times New Roman") %>%
  tab_options(table_body.hlines.color = "black", source_notes.border.bottom.color = "black", table_body.border.bottom.color = "black",
              table_body.border.top.color = "black", row_group.border.top.color = "black", row_group.border.bottom.color = "black",
              heading.border.bottom.color = "black", column_labels.border.top.color = "black",  table.border.top.color = "black",
              table.border.bottom.color = "black", column_labels.border.bottom.color = "black")

t_comp_m
```

## Distribution

### Nombre de genres écoutés

Echantillon non matché

```{r}
ggplot(PC18_to_m) + 
    aes(x = as.factor(nbr_genre_music), group=stream_spe, fill = as.factor(stream_spe), colour = as.factor(stream_spe),  weight = PC18_to_m$POND) + 
    geom_bar(aes(y = ..prop..), position = "identity",alpha = 5/10) +
  scale_x_discrete(name = "Nombre de genres écoutés") +
  scale_y_continuous(limits = c(0, 0.25), breaks = seq(0, 0.25, by = 0.05), name = "Proportion d'individus", 
                     labels = c("0 %", "5 %", "10 %", "15 %", "20 %", "25 %")) +
  scale_fill_discrete(name = "Groupe", labels = c("Non streameurs", "Streameurs")) +
  scale_color_discrete(name = "Groupe", labels = c("Non streameurs", "Streameurs"))
```

Echantillon matché

```{r}
ggplot(PC18_m) + 
    aes(x = as.factor(nbr_genre_music), group=stream_spe, fill = as.factor(stream_spe), colour = as.factor(stream_spe),  weight = PC18_m$POND) + 
    geom_bar(aes(y = ..prop..), position = "identity",alpha = 5/10) +
  scale_x_discrete(name = "Nombre de genres écoutés") +
  scale_y_continuous(limits = c(0, 0.25), breaks = seq(0, 0.25, by = 0.05), name = "Proportion d'individus", 
                     labels = c("0 %", "5 %", "10 %", "15 %", "20 %", "25 %")) +
  scale_fill_discrete(name = "Groupe", labels = c("Non streameurs", "Streameurs")) +
  scale_color_discrete(name = "Groupe", labels = c("Non streameurs", "Streameurs"))
```

### Nombre de genres particulièrement aimés

Echantillon non matché

```{r}
mutate(PC18_to_m, nbr_genre_aime = factor(nbr_genre_aime, levels = 0:13, labels = c("0", "1", "2", "3", "4", "5 ou +", "5 ou +", "5 ou +", "5 ou +", "5 ou +", "5 ou +", "5 ou +", "5 ou +", "5 ou +"))) %>%
ggplot() + 
    aes(x = nbr_genre_aime, group=stream_spe, fill = as.factor(stream_spe), colour = as.factor(stream_spe),  weight = PC18_to_m$POND) + 
    geom_bar(aes(y = ..prop..), position = "identity",alpha = 5/10) +
  scale_x_discrete(name = "Nombre de genres particulièrement aimés") +
  scale_y_continuous(limits = c(0, 0.6), breaks = seq(0, 0.6, by = 0.05), name = "Proportion d'individus", 
                     labels = c("0 %", "5 %", "10 %", "15 %", "20 %", "25 %", "30 %", "35 %", "40 %", "45 %",
                                "50 %", "55 %", "60 %")) +
  scale_fill_discrete(name = "Groupe", labels = c("Non streameurs", "Streameurs")) +
  scale_color_discrete(name = "Groupe", labels = c("Non streameurs", "Streameurs"))
```

Echantillon matché

```{r}
mutate(PC18_m, nbr_genre_aime = factor(nbr_genre_aime, levels = 0:13, labels = c("0", "1", "2", "3", "4", "5 ou +", "5 ou +", "5 ou +", "5 ou +", "5 ou +", "5 ou +", "5 ou +", "5 ou +", "5 ou +"))) %>%
ggplot() + 
    aes(x = nbr_genre_aime, group=stream_spe, fill = as.factor(stream_spe), colour = as.factor(stream_spe),  weight = PC18_m$POND) + 
    geom_bar(aes(y = ..prop..), position = "identity",alpha = 5/10) +
  scale_x_discrete(name = "Nombre de genres particulièrement aimés") +
  scale_y_continuous(limits = c(0, 0.6), breaks = seq(0, 0.6, by = 0.05), name = "Proportion d'individus", 
                     labels = c("0 %", "5 %", "10 %", "15 %", "20 %", "25 %", "30 %", "35 %", "40 %", "45 %",
                                "50 %", "55 %", "60 %")) +
  scale_fill_discrete(name = "Groupe", labels = c("Non streameurs", "Streameurs")) +
  scale_color_discrete(name = "Groupe", labels = c("Non streameurs", "Streameurs"))
```

### Nombre de genres detesté

Echantillon non matché

```{r}
mutate(PC18_to_m, nbr_genre_deteste = factor(nbr_genre_deteste, levels = 0:13, labels = c("0", "1", "2", "3", "4", "5 ou +", "5 ou +", "5 ou +", "5 ou +", "5 ou +", "5 ou +", "5 ou +", "5 ou +", "5 ou +"))) %>%
ggplot() + 
    aes(x = nbr_genre_deteste, group=stream_spe, fill = as.factor(stream_spe), colour = as.factor(stream_spe),  weight = PC18_to_m$POND) + 
    geom_bar(aes(y = ..prop..), position = "identity",alpha = 5/10) +
  scale_x_discrete(name = "Nombre de genres detesté") +
  scale_y_continuous(limits = c(0, 0.6), breaks = seq(0, 0.6, by = 0.05), name = "Proportion d'individus", 
                     labels = c("0 %", "5 %", "10 %", "15 %", "20 %", "25 %", "30 %", "35 %", "40 %", "45 %",
                                "50 %", "55 %", "60 %")) +
  scale_fill_discrete(name = "Groupe", labels = c("Non streameurs", "Streameurs")) +
  scale_color_discrete(name = "Groupe", labels = c("Non streameurs", "Streameurs"))
```

Echantillon matché

```{r}
mutate(PC18_m, nbr_genre_deteste = factor(nbr_genre_deteste, levels = 0:13, labels = c("0", "1", "2", "3", "4", "5 ou +", "5 ou +", "5 ou +", "5 ou +", "5 ou +", "5 ou +", "5 ou +", "5 ou +", "5 ou +"))) %>%
ggplot() + 
    aes(x = nbr_genre_deteste, group=stream_spe, fill = as.factor(stream_spe), colour = as.factor(stream_spe),  weight = PC18_m$POND) + 
    geom_bar(aes(y = ..prop..), position = "identity",alpha = 5/10) +
  scale_x_discrete(name = "Nombre de genres detesté") +
  scale_y_continuous(limits = c(0, 0.6), breaks = seq(0, 0.6, by = 0.05), name = "Proportion d'individus", 
                     labels = c("0 %", "5 %", "10 %", "15 %", "20 %", "25 %", "30 %", "35 %", "40 %", "45 %",
                                "50 %", "55 %", "60 %")) +
  scale_fill_discrete(name = "Groupe", labels = c("Non streameurs", "Streameurs")) +
  scale_color_discrete(name = "Groupe", labels = c("Non streameurs", "Streameurs"))
```

### Nombre d'artistes déjà écoutés

Echantillon non matché

```{r}
ggplot(PC18_to_m) + 
    aes(x = as.factor(nbr_artiste_ecoute), group=stream_spe, fill = as.factor(stream_spe), colour = as.factor(stream_spe),  weight = PC18_to_m$POND) + 
    geom_bar(aes(y = ..prop..), position = "identity",alpha = 5/10) +
  scale_x_discrete(name = "Nombre d'artistes écoutés") +
  scale_y_continuous(limits = c(0, 0.25), breaks = seq(0, 0.25, by = 0.05), name = "Proportion d'individus", 
                     labels = c("0 %", "5 %", "10 %", "15 %", "20 %", "25 %")) +
  scale_fill_discrete(name = "Groupe", labels = c("Non streameurs", "Streameurs")) +
  scale_color_discrete(name = "Groupe", labels = c("Non streameurs", "Streameurs"))
```

Echantillon matché

```{r}
ggplot(PC18_m) + 
    aes(x = as.factor(nbr_artiste_ecoute), group=stream_spe, fill = as.factor(stream_spe), colour = as.factor(stream_spe),  weight = PC18_m$POND) + 
    geom_bar(aes(y = ..prop..), position = "identity",alpha = 5/10) +
  scale_x_discrete(name = "Nombre d'artistes écoutés") +
  scale_y_continuous(limits = c(0, 0.25), breaks = seq(0, 0.25, by = 0.05), name = "Proportion d'individus", 
                     labels = c("0 %", "5 %", "10 %", "15 %", "20 %", "25 %")) +
  scale_fill_discrete(name = "Groupe", labels = c("Non streameurs", "Streameurs")) +
  scale_color_discrete(name = "Groupe", labels = c("Non streameurs", "Streameurs"))
```


# Proportion d'écoute par genre


## genres écoutés

```{r}
mean_genre_unm <- PC18_to_m_survey %>%
  tbl_svysummary(
        include = c("E1001", "E1002", "E1003", "E1004", "E1005", "E1006", "E1007", 
                "E1008", "E1009", "E1010", "E1011", "E1012", "E1013"), #L'ensemble des variables que l'on veut dans le tableau
    label = list(E1001 ~ "Variété française",
                 E1002 ~ "Musique du monde",
                 E1003 ~ "Musique traditionnelle",
                 E1004 ~ "Variété internationnale",
                 E1005 ~ "RnB",
                 E1006 ~ "Electro/techno",
                 E1007 ~ "Hip hop/rap",
                 E1008 ~ "Metal/Hard rock",
                 E1009 ~ "Pop/rock",
                 E1010 ~ "Jazz",
                 E1011 ~ "Opera",
                 E1012 ~ "Musique classique",
                 E1013 ~ "Autre(s) genre(s) de musique"),
    by = stream_spe, #La variale avec laquelle on croise les données qui ira en colonne
    missing = "ifany",
        statistic = list(all_continuous() ~ "{mean} ans ({sd})",
                     all_categorical() ~ "{p} %"),
    digits = list(all_continuous() ~ c(0,0))
  ) %>%
  add_p(test = list(all_continuous() ~ "svy.t.test",
                    all_categorical() ~ "svy.chisq.test")) %>%
  modify_header(label = "**Ecoute :**",
                update = list(stat_1 ~ html("**Non streameur**<br> N = {n_unweighted}"),
                              stat_2 ~ html("**Streameur**<br> N = {n_unweighted}"))) %>%
  modify_footnote(update = everything() ~ NA) %>%
  modify_footnote(update = list(p.value ~ "Calculé à partir d'un test de Khi-2",
                                all_stat_cols() ~ "Effectifs non pondérés."))


mean_genre_m <- PC18_m_survey %>%
  tbl_svysummary(
        include = c("E1001", "E1002", "E1003", "E1004", "E1005", "E1006", "E1007", 
                "E1008", "E1009", "E1010", "E1011", "E1012", "E1013"), #L'ensemble des variables que l'on veut dans le tableau
    label = list(E1001 ~ "Variété française",
                 E1002 ~ "Musique du monde",
                 E1003 ~ "Musique traditionnelle",
                 E1004 ~ "Variété internationnale",
                 E1005 ~ "RnB",
                 E1006 ~ "Electro/techno",
                 E1007 ~ "Hip hop/rap",
                 E1008 ~ "Metal/Hard rock",
                 E1009 ~ "Pop/rock",
                 E1010 ~ "Jazz",
                 E1011 ~ "Opera",
                 E1012 ~ "Musique classique",
                 E1013 ~ "Autre(s) genre(s) de musique"),
    by = stream_spe, #La variale avec laquelle on croise les données qui ira en colonne
    missing = "ifany",
        statistic = list(all_continuous() ~ "{mean} ans ({sd})",
                     all_categorical() ~ "{p} %"),
    digits = list(all_continuous() ~ c(0,0))
  ) %>%
  add_p(test = list(all_continuous() ~ "svy.t.test",
                    all_categorical() ~ "svy.chisq.test")) %>%
  modify_header(label = "**Ecoute :**",
                update = list(stat_1 ~ html("**Non streameur**<br> N = {n_unweighted}"),
                              stat_2 ~ html("**Streameur**<br> N = {n_unweighted}"))) %>%
  modify_footnote(update = everything() ~ NA) %>%
  modify_footnote(update = list(p.value ~ "Calculé à partir d'un test de Khi-2",
                                all_stat_cols() ~ "Effectifs non pondérés."))

t_comp_genre_ecoute_m <- tbl_merge(
    tbls = list(mean_genre_unm, mean_genre_m),
    tab_spanner = c("**Echantillon non matché**", "**Echantillon matché**")
  ) %>% as_gt() %>%
  tab_footnote(
    footnote = "Pourcentage pondéré.",
    locations = cells_body(columns = stat_1_1,
                           rows = 1)
  ) %>%
  tab_source_note(source_note = html("<p align=\"justify\" style=\"
    margin: 0;\"><u>Source</u> : Enquête Pratique culturelles des français 2018.
                                     <br><u>Champ</u> : Résidant en France agés de 15 ans et plus, déclarant écouter de la musique.
                                     <br><u>Lecture</u> : Dans l'échantillon non matché, c'est-à-dire dans la population générale minorée des individus n'écoutant pas de musique, on observe que 82 % des non-utilisateurs de plateformes de streaming spécialisées écoutent de la variété française. 73 % de ceux qui pratiquent l'écoute en streaming déclarent en écouter.
                                     <br> Dans la population matchée en revanche, on observe pas d'écart significatif entre les deux groupes. Ainsi, quand on raisonne toutes choses égales par ailleurs, 73 % des non-streameurs et des streameurs écoutent de la variété française.</p>")) %>%
  opt_table_font(font = "Times New Roman") %>%
  tab_options(table_body.hlines.color = "black", source_notes.border.bottom.color = "black", table_body.border.bottom.color = "black",
              table_body.border.top.color = "black", row_group.border.top.color = "black", row_group.border.bottom.color = "black",
              heading.border.bottom.color = "black", column_labels.border.top.color = "black",  table.border.top.color = "black",
              table.border.bottom.color = "black", column_labels.border.bottom.color = "black")

t_comp_genre_ecoute_m
```

## Genre particulièrement aimés

```{r}



mean_genre_unm <- PC18_to_m_survey %>%
  tbl_svysummary(
            include = c("E1201", "E1202", "E1203", "E1204", "E1205", "E1206", "E1207", 
                "E1208", "E1209", "E1210", "E1211", "E1212", "E1213"), #L'ensemble des variables que l'on veut dans le tableau
    label = list(E1201 ~ "Aime variété française",
                 E1202 ~ "Aime musique du monde",
                 E1203 ~ "Aime musique traditionnelle",
                 E1204 ~ "Aime variété internationnale",
                 E1205 ~ "Aime RnB",
                 E1206 ~ "Aime électro/techno",
                 E1207 ~ "Aime hip hop/rap",
                 E1208 ~ "Aime metal/Hard rock",
                 E1209 ~ "Aime pop/rock",
                 E1210 ~ "Aime jazz",
                 E1211 ~ "Aime opera",
                 E1212 ~ "Aime musique classique",
                 E1213 ~ "Aime autre(s) genre(s) de musique"),
    by = stream_spe, #La variale avec laquelle on croise les données qui ira en colonne
    missing = "ifany",
        statistic = list(all_continuous() ~ "{mean} ans ({sd})",
                     all_categorical() ~ "{p} %"),
    digits = list(all_continuous() ~ c(0,0))
  ) %>%
  add_p(test = list(all_continuous() ~ "svy.t.test",
                    all_categorical() ~ "svy.chisq.test")) %>%
  modify_header(update = list(stat_1 ~ html("**Non streameur**<br> N = {n_unweighted}"),
                              stat_2 ~ html("**Streameur**<br> N = {n_unweighted}"))) %>%
  modify_footnote(update = everything() ~ NA) %>%
  modify_footnote(update = list(p.value ~ "Calculé à partir d'un test de Khi²",
                                all_stat_cols() ~ "Pourcentages pondérés"))


mean_genre_m <- PC18_m_survey %>%
  tbl_svysummary(
            include = c("E1201", "E1202", "E1203", "E1204", "E1205", "E1206", "E1207", 
                "E1208", "E1209", "E1210", "E1211", "E1212", "E1213"), #L'ensemble des variables que l'on veut dans le tableau
    label = list(E1201 ~ "Aime variété française",
                 E1202 ~ "Aime musique du monde",
                 E1203 ~ "Aime musique traditionnelle",
                 E1204 ~ "Aime variété internationnale",
                 E1205 ~ "Aime RnB",
                 E1206 ~ "Aime électro/techno",
                 E1207 ~ "Aime hip hop/rap",
                 E1208 ~ "Aime metal/Hard rock",
                 E1209 ~ "Aime pop/rock",
                 E1210 ~ "Aime jazz",
                 E1211 ~ "Aime opera",
                 E1212 ~ "Aime musique classique",
                 E1213 ~ "Aime autre(s) genre(s) de musique"),
    by = stream_spe, #La variale avec laquelle on croise les données qui ira en colonne
    missing = "ifany",
    statistic = list(all_continuous() ~ "{mean} ans ({sd})",
                     all_categorical() ~ "{p} %"),
    digits = list(all_continuous() ~ c(0,0))
  ) %>%
  add_p(test = list(all_continuous() ~ "svy.t.test",
                    all_categorical() ~ "svy.chisq.test")) %>%
  modify_header(update = list(stat_1 ~ html("**Non streameur**<br> N = {n_unweighted}"),
                              stat_2 ~ html("**Streameur**<br> N = {n_unweighted}"))) %>%
  modify_footnote(update = everything() ~ NA) %>%
  modify_footnote(update = list(p.value ~ "Calculé à partir d'un test de Khi²",
                                all_stat_cols() ~ "Pourcentages pondérés"))

t_comp_genre_aime_m <- tbl_merge(
    tbls = list(mean_genre_unm, mean_genre_m),
    tab_spanner = c("**Echantillon non matché**", "**Echantillon matché**")
  ) %>% as_gt() %>%
  tab_source_note(source_note = html("Source : Enquête Pratique culturelles des français 2018. Effectifs non pondérés.
                                     <br> Champ : Résidant en France agés de 15 ans et plus, déclarant écouter de la musique.")) %>%
  tab_header(title = "Comparaison proportion aimé particulièrement par genre entre streameurs et non streameurs") %>%
  opt_table_font(font = "Times New Roman") %>%
  tab_options(table_body.hlines.color = "black", source_notes.border.bottom.color = "black", table_body.border.bottom.color = "black",
              table_body.border.top.color = "black", row_group.border.top.color = "black", row_group.border.bottom.color = "black",
              heading.border.bottom.color = "black", column_labels.border.top.color = "black",  table.border.top.color = "black",
              table.border.bottom.color = "black", column_labels.border.bottom.color = "black")

t_comp_genre_aime_m
```


## Genre detesté

```{r}



mean_genre_unm <- PC18_to_m_survey %>%
  tbl_svysummary(
    include = c("E1301", "E1302", "E1303", "E1304", "E1305", "E1306", "E1307", 
                "E1308", "E1309", "E1310", "E1311", "E1312", "E1313"), #L'ensemble des variables que l'on veut dans le tableau
    label = list(E1301 ~ "Aime pas du tout variété française",
                 E1302 ~ "Aime pas du tout musique du monde",
                 E1303 ~ "Aime pas du tout musique traditionnelle",
                 E1304 ~ "Aime pas du tout variété internationnale",
                 E1305 ~ "Aime pas du tout RnB",
                 E1306 ~ "Aime pas du tout électro/techno",
                 E1307 ~ "Aime pas du tout hip hop/rap",
                 E1308 ~ "Aime pas du tout metal/Hard rock",
                 E1309 ~ "Aime pas du tout pop/rock",
                 E1310 ~ "Aime pas du tout jazz",
                 E1311 ~ "Aime pas du tout opera",
                 E1312 ~ "Aime pas du tout musique classique",
                 E1313 ~ "Aime pas du tout autre(s) genre(s) de musique"),
    by = stream_spe, #La variale avec laquelle on croise les données qui ira en colonne
    missing = "ifany",
        statistic = list(all_continuous() ~ "{mean} ans ({sd})",
                     all_categorical() ~ "{p} %"),
    digits = list(all_continuous() ~ c(0,0))
  ) %>%
  add_p(test = list(all_continuous() ~ "svy.t.test",
                    all_categorical() ~ "svy.chisq.test")) %>%
  modify_header(update = list(stat_1 ~ html("**Non streameur**<br> N = {n_unweighted}"),
                              stat_2 ~ html("**Streameur**<br> N = {n_unweighted}"))) %>%
  modify_footnote(update = everything() ~ NA) %>%
  modify_footnote(update = list(p.value ~ "Calculé à partir d'un test de Khi²",
                                all_stat_cols() ~ "Pourcentages pondérés"))


mean_genre_m <- PC18_m_survey %>%
  tbl_svysummary(
    include = c("E1301", "E1302", "E1303", "E1304", "E1305", "E1306", "E1307", 
                "E1308", "E1309", "E1310", "E1311", "E1312", "E1313"), #L'ensemble des variables que l'on veut dans le tableau
    label = list(E1301 ~ "Aime pas du tout variété française",
                 E1302 ~ "Aime pas du tout musique du monde",
                 E1303 ~ "Aime pas du tout musique traditionnelle",
                 E1304 ~ "Aime pas du tout variété internationnale",
                 E1305 ~ "Aime pas du tout RnB",
                 E1306 ~ "Aime pas du tout électro/techno",
                 E1307 ~ "Aime pas du tout hip hop/rap",
                 E1308 ~ "Aime pas du tout metal/Hard rock",
                 E1309 ~ "Aime pas du tout pop/rock",
                 E1310 ~ "Aime pas du tout jazz",
                 E1311 ~ "Aime pas du tout opera",
                 E1312 ~ "Aime pas du tout musique classique",
                 E1313 ~ "Aime pas du tout autre(s) genre(s) de musique"),
    by = stream_spe, #La variale avec laquelle on croise les données qui ira en colonne
    missing = "ifany",
    statistic = list(all_continuous() ~ "{mean} ans ({sd})",
                     all_categorical() ~ "{p} %"),
    digits = list(all_continuous() ~ c(0,0))
  ) %>%
  add_p(test = list(all_continuous() ~ "svy.t.test",
                    all_categorical() ~ "svy.chisq.test")) %>%
  modify_header(update = list(stat_1 ~ html("**Non streameur**<br> N = {n_unweighted}"),
                              stat_2 ~ html("**Streameur**<br> N = {n_unweighted}"))) %>%
  modify_footnote(update = everything() ~ NA) %>%
  modify_footnote(update = list(p.value ~ "Calculé à partir d'un test de Khi²",
                                all_stat_cols() ~ "Pourcentages pondérés"))

t_comp_genre_deteste_m <- tbl_merge(
    tbls = list(mean_genre_unm, mean_genre_m),
    tab_spanner = c("**Echantillon non matché**", "**Echantillon matché**")
  ) %>% as_gt() %>%
  tab_source_note(source_note = html("Source : Enquête Pratique culturelles des français 2018. Effectifs non pondérés.
                                     <br> Champ : Résidant en France agés de 15 ans et plus, déclarant écouter de la musique.")) %>%
  tab_header(title = "Comparaison proportion detesté par genre entre streameurs et non streameurs") %>%
  opt_table_font(font = "Times New Roman") %>%
  tab_options(table_body.hlines.color = "black", source_notes.border.bottom.color = "black", table_body.border.bottom.color = "black",
              table_body.border.top.color = "black", row_group.border.top.color = "black", row_group.border.bottom.color = "black",
              heading.border.bottom.color = "black", column_labels.border.top.color = "black",  table.border.top.color = "black",
              table.border.bottom.color = "black", column_labels.border.bottom.color = "black")

t_comp_genre_deteste_m
```

## Proportion artistes déjà écoutés dans la liste

```{r}

mean_artistes_unm <- PC18_to_m_survey %>%
  tbl_svysummary(
        include = c("E1401", "E1402", "E1403", "E1404", "E1405", "E1406", "E1407", 
                "E1408", "E1409", "E1410", "E1411", "E1412", "E1413",  "E1414",  "E1415"), #L'ensemble des variables que l'on veut dans le tableau
    label = list(E1401 ~ "Bob Marley",
                 E1402 ~ "Miles Davis",
                 E1403 ~ "Julien Doré",
                 E1404 ~ "Coldplay",
                 E1405 ~ "Cesaria Evora",
                 E1406 ~ "Rihanna",
                 E1407 ~ "Booba",
                 E1408 ~ "NTM",
                 E1409 ~ "Metallica",
                 E1410 ~ "Jacques Brel",
                 E1411 ~ "David Bowie",
                 E1412 ~ "Beethoven",
                 E1413 ~ "Bob Sinclar",
                 E1414 ~ "Céline Dion",
                 E1415 ~ "Renaud"),
    by = stream_spe, #La variale avec laquelle on croise les données qui ira en colonne
    missing = "ifany",
        statistic = list(all_continuous() ~ "{mean} ans ({sd})",
                     all_categorical() ~ "{p} %"),
    digits = list(all_continuous() ~ c(0,0))
  ) %>%
  add_p(test = list(all_continuous() ~ "svy.t.test",
                    all_categorical() ~ "svy.chisq.test")) %>%
  modify_header(update = list(stat_1 ~ html("**Non streameur**<br> N = {n_unweighted}"),
                              stat_2 ~ html("**Streameur**<br> N = {n_unweighted}"))) %>%
  modify_footnote(update = everything() ~ NA) %>%
  modify_footnote(update = list(p.value ~ "Calculé à partir d'un test de Khi²",
                                all_stat_cols() ~ "Pourcentages pondérés"))


mean_artistes_m <- PC18_m_survey %>%
  tbl_svysummary(
        include = c("E1401", "E1402", "E1403", "E1404", "E1405", "E1406", "E1407", 
                "E1408", "E1409", "E1410", "E1411", "E1412", "E1413",  "E1414",  "E1415"), #L'ensemble des variables que l'on veut dans le tableau
    label = list(E1401 ~ "Bob Marley",
                 E1402 ~ "Miles Davis",
                 E1403 ~ "Julien Doré",
                 E1404 ~ "Coldplay",
                 E1405 ~ "Cesaria Evora",
                 E1406 ~ "Rihanna",
                 E1407 ~ "Booba",
                 E1408 ~ "NTM",
                 E1409 ~ "Metallica",
                 E1410 ~ "Jacques Brel",
                 E1411 ~ "David Bowie",
                 E1412 ~ "Beethoven",
                 E1413 ~ "Bob Sinclar",
                 E1414 ~ "Céline Dion",
                 E1415 ~ "Renaud"),
    by = stream_spe, #La variale avec laquelle on croise les données qui ira en colonne
    missing = "ifany",
    statistic = list(all_continuous() ~ "{mean} ans ({sd})",
                     all_categorical() ~ "{p} %"),
    digits = list(all_continuous() ~ c(0,0))
  ) %>%
  add_p(test = list(all_continuous() ~ "svy.t.test",
                    all_categorical() ~ "svy.chisq.test")) %>%
  modify_header(update = list(stat_1 ~ html("**Non streameur**<br> N = {n_unweighted}"),
                              stat_2 ~ html("**Streameur**<br> N = {n_unweighted}"))) %>%
  modify_footnote(update = everything() ~ NA) %>%
  modify_footnote(update = list(p.value ~ "Calculé à partir d'un test de Khi²",
                                all_stat_cols() ~ "Pourcentages pondérés"))

t_comp_artistes_m <- tbl_merge(
    tbls = list(mean_artistes_unm, mean_artistes_m),
    tab_spanner = c("**Echantillon non matché**", "**Echantillon matché**")
  ) %>% as_gt() %>%
  tab_source_note(source_note = html("Source : Enquête Pratique culturelles des français 2018. Effectifs non pondérés.
                                     <br> Champ : Résidant en France agés de 15 ans et plus, déclarant écouter de la musique.")) %>%
  tab_header(title = "Comparaison proportion écoute par artiste entre streameurs et non streameurs") %>%
  opt_table_font(font = "Times New Roman") %>%
  tab_options(table_body.hlines.color = "black", source_notes.border.bottom.color = "black", table_body.border.bottom.color = "black",
              table_body.border.top.color = "black", row_group.border.top.color = "black", row_group.border.bottom.color = "black",
              heading.border.bottom.color = "black", column_labels.border.top.color = "black",  table.border.top.color = "black",
              table.border.bottom.color = "black", column_labels.border.bottom.color = "black")

t_comp_artistes_m
```

# Proportion d'appartenances aux classes de la CAH

```{r}
mean_classe_unm <- PC18_to_m_survey %>%
  tbl_svysummary(
        include = c("etab_leg", "etab_pop", "emerg_leg", "emerg_pop"), #L'ensemble des variables que l'on veut dans le tableau
    label = list(etab_leg ~ "Etabli légitime",
                 etab_pop ~ "Etabli populaire",
                 emerg_leg ~ "Emergeant légitime",
                 emerg_pop ~ "Emergeant populaire"),
    by = stream_spe, #La variale avec laquelle on croise les données qui ira en colonne
    missing = "ifany",
        statistic = list(all_continuous() ~ "{mean} ans ({sd})",
                     all_categorical() ~ "{p} %"),
    digits = list(all_continuous() ~ c(0,0))
  ) %>%
  add_p(test = list(all_continuous() ~ "svy.t.test",
                    all_categorical() ~ "svy.chisq.test")) %>%
  modify_header(label = "**Classe d'appartenance :**",
    update = list(stat_1 ~ html("**Non streameur**<br> N = {n_unweighted}"),
                              stat_2 ~ html("**Streameur**<br> N = {n_unweighted}"))) %>%
  modify_footnote(update = everything() ~ NA) %>%
  modify_footnote(update = list(p.value ~ "Calculé à partir d'un test de Khi²",
                                all_stat_cols() ~ "Effectifs non pondérés."))


mean_classe_m <- PC18_m_survey %>%
  tbl_svysummary(
        include = c("etab_leg", "etab_pop", "emerg_leg", "emerg_pop"), #L'ensemble des variables que l'on veut dans le tableau
    label = list(etab_leg ~ "Etabli légitime",
                 etab_pop ~ "Etabli populaire",
                 emerg_leg ~ "Emergeant légitime",
                 emerg_pop ~ "Emergeant populaire"),
    by = stream_spe, #La variale avec laquelle on croise les données qui ira en colonne
    missing = "ifany",
        statistic = list(all_continuous() ~ "{mean} ans ({sd})",
                     all_categorical() ~ "{p} %"),
    digits = list(all_continuous() ~ c(0,0))
  ) %>%
  add_p(test = list(all_continuous() ~ "svy.t.test",
                    all_categorical() ~ "svy.chisq.test")) %>%
  modify_header(label = "**Classe d'appartenance :**",
    update = list(stat_1 ~ html("**Non streameur**<br> N = {n_unweighted}"),
                              stat_2 ~ html("**Streameur**<br> N = {n_unweighted}"))) %>%
  modify_footnote(update = everything() ~ NA) %>%
  modify_footnote(update = list(p.value ~ "Calculé à partir d'un test de Khi²",
                                all_stat_cols() ~ "Effectifs non pondérés."))

t_comp_classe_m <- tbl_merge(
    tbls = list(mean_classe_unm, mean_classe_m),
    tab_spanner = c("**Echantillon non matché**", "**Echantillon matché**")
  ) %>% as_gt() %>%
  tab_footnote(
    footnote = "Pourcentage pondérés.",
    locations = cells_body(columns = stat_1_1,
                           rows = 1)
  ) %>%
  tab_source_note(source_note = html("<p align=\"justify\" style=\"
    margin: 0;\"><u>Source</u> : Enquête Pratique culturelles des français 2018.
                                     <br><u>Champ</u> : Résidant en France agés de 15 ans et plus, déclarant écouter de la musique.
                                     <br><u>Lecture</u> : Dans l'échantillon non matché, c'est-à-dire dans la population générale minorée des individus n'écoutant pas de musique, on observe que 22 % des non-utilisateurs de plateformes de streaming spécialisées appartiennent à la classe d'univers de goût établi légitime. 10 % de ceux qui pratiquent l'écoute en streaming appartiennent à cette classe.
                                     <br> Dans la population matchée en revanche, on observe des écarts beaucoup plus faibles. Ainsi, quand on raisonne toutes choses égales par ailleurs, 14 % des non-streameurs appartiennent à la classe établi légitime, alors que les streameurs sont 10 % à y appartenir.</p>")) %>%
  tab_header(title = "Comparaison proportion écoute par artiste entre streameurs et non streameurs") %>%
  opt_table_font(font = "Times New Roman") %>%
  tab_options(table_body.hlines.color = "black", source_notes.border.bottom.color = "black", table_body.border.bottom.color = "black",
              table_body.border.top.color = "black", row_group.border.top.color = "black", row_group.border.bottom.color = "black",
              heading.border.bottom.color = "black", column_labels.border.top.color = "black",  table.border.top.color = "black",
              table.border.bottom.color = "black", column_labels.border.bottom.color = "black")

t_comp_classe_m
```

# Proportion écoute quotidienne, pour elle même et manque

```{r}
mean_prat_unm <- PC18_to_m_survey %>%
  tbl_svysummary(
        include = c("music_TLJ", "music_ellememe", "music_manque"), #L'ensemble des variables que l'on veut dans le tableau
    label = list(music_TLJ ~ "Ecoute de la musique tous les jours",
                 music_ellememe ~ "Ecoute de la musique pour elle même, sans rien faire d'autre",
                 music_manque ~ "\"Si vous ne pouviez plus écouter de musique, cela manquerait ?\""),
    by = stream_spe, #La variale avec laquelle on croise les données qui ira en colonne
    missing = "ifany",
        statistic = list(all_continuous() ~ "{mean} ans ({sd})",
                     all_categorical() ~ "{p} %"),
    digits = list(all_continuous() ~ c(0,0))
  ) %>%
  add_p(test = list(all_continuous() ~ "svy.t.test",
                    all_categorical() ~ "svy.chisq.test")) %>%
  modify_header(update = list(stat_1 ~ html("**Non streameur**<br> N = {n_unweighted}"),
                              stat_2 ~ html("**Streameur**<br> N = {n_unweighted}"))) %>%
  modify_footnote(update = everything() ~ NA) %>%
  modify_footnote(update = list(p.value ~ "Calculé à partir d'un test de Khi²",
                                all_stat_cols() ~ "Effectifs non pondérés."))


mean_prat_m <- PC18_m_survey %>%
  tbl_svysummary(
        include = c("music_TLJ", "music_ellememe", "music_manque"), #L'ensemble des variables que l'on veut dans le tableau
    label = list(music_TLJ ~ "Ecoute de la musique tous les jours",
                 music_ellememe ~ "Ecoute de la musique pour elle même, sans rien faire d'autre",
                 music_manque ~ "\"Si vous ne pouviez plus écouter de musique, cela manquerait ?\""),
    by = stream_spe, #La variale avec laquelle on croise les données qui ira en colonne
    missing = "ifany",
    statistic = list(all_continuous() ~ "{mean} ans ({sd})",
                     all_categorical() ~ "{p} %"),
    digits = list(all_continuous() ~ c(0,0))
  ) %>%
  add_p(test = list(all_continuous() ~ "svy.t.test",
                    all_categorical() ~ "svy.chisq.test")) %>%
  modify_header(update = list(stat_1 ~ html("**Non streameur**<br> N = {n_unweighted}"),
                              stat_2 ~ html("**Streameur**<br> N = {n_unweighted}"))) %>%
  modify_footnote(update = everything() ~ NA) %>%
  modify_footnote(update = list(p.value ~ "Calculé à partir d'un test de Khi²",
                                all_stat_cols() ~ "Effectifs non pondérés."))

t_comp_prat_m <- tbl_merge(
    tbls = list(mean_prat_unm, mean_prat_m),
    tab_spanner = c("**Echantillon non matché**", "**Echantillon matché**")
  ) %>% as_gt() %>%
  tab_footnote(
    footnote = "Pourcentage pondérés.",
    locations = cells_body(columns = stat_1_1,
                           rows = 1)
  ) %>%
  tab_source_note(source_note = html("<p align=\"justify\" style=\"
    margin: 0;\"><u>Source</u> : Enquête Pratique culturelles des français 2018.
                                     <br><u>Champ</u> : Résidant en France agés de 15 ans et plus, déclarant écouter de la musique.
                                     <br><u>Lecture</u> : Dans l'échantillon non matché, c'est-à-dire dans la population générale minorée des individus n'écoutant pas de musique, on observe que 63 % des non-utilisateurs de plateformes de streaming spécialisées écoutent de la musique tous les jours. 83 % de ceux qui pratiquent l'écoute en streaming déclarent eux écouter tous les jours.
                                     <br> Dans la population matchée en revanche, on observe des écarts beaucoup plus faibles. Ainsi, quand on raisonne toutes choses égales par ailleurs, 78 % des non-streameurs écoutent de la musique tous les jours, alors que les streameurs sont 83 % à le faire.</p>")) %>%
  opt_table_font(font = "Times New Roman") %>%
  tab_options(table_body.hlines.color = "black", source_notes.border.bottom.color = "black", table_body.border.bottom.color = "black",
              table_body.border.top.color = "black", row_group.border.top.color = "black", row_group.border.bottom.color = "black",
              heading.border.bottom.color = "black", column_labels.border.top.color = "black",  table.border.top.color = "black",
              table.border.bottom.color = "black", column_labels.border.bottom.color = "black")

t_comp_prat_m
```

# Effet variable en fonction de certaines catégories d'individus

## Interaction avec l'age

### nombre de styles écoutés

Avant matching


```{r}
lm_nbr_genre_bfm <- lm(nbr_genre_music ~ stream_spe + AGE + stream_spe * AGE, PC18_to_m, weights = POND)

coeftest(lm_nbr_genre_bfm, vcov. = vcovHC)



lm_nbr_genre_bfm <- lm(nbr_genre_music ~ stream_spe + AGE_r + stream_spe * AGE_r, PC18_to_m, weights = POND)

coeftest(lm_nbr_genre_bfm, vcov. = vcovHC)

```


Après matching

```{r}
lm_nbr_genre_afm <- lm(nbr_genre_music ~ stream_spe + AGE + stream_spe * AGE, PC18_m, weights = POND_m)

coeftest(lm_nbr_genre_afm, vcov. = vcovHC)


lm_nbr_genre_afm <- lm(nbr_genre_music ~ stream_spe + AGE_r + stream_spe * AGE_r, PC18_m, weights = POND_m)

coeftest(lm_nbr_genre_afm, vcov. = vcovHC)
```


## Interaction avec le diplome

### nombre de styles écoutés

Avant matching

```{r}
lm_nbr_genre_bfm <- lm(nbr_genre_music ~ stream_spe + DIPLOME_r + stream_spe * DIPLOME_r, PC18_to_m, weights = POND)

coeftest(lm_nbr_genre_bfm, vcov. = vcovHC)

```

Après matching

```{r}
lm_nbr_genre_afm <- lm(nbr_genre_music ~ stream_spe + DIPLOME_r + stream_spe * DIPLOME_r, PC18_m, weights = POND_m)

coeftest(lm_nbr_genre_afm, vcov. = vcovHC)
```
